@using Web.Areas.StockAdministration;
<script type="text/javascript">


    window.feature.modal={};
    window.feature.modal.stores ={};
    window.feature.modal.models ={};

</script>
<script type="text/javascript">
    window.feature.modal.models.Schedule =  Ext.define('Ext.feature.Schedule', {
        extend: 'Ext.data.Model',
        fields: [
                { name: 'Id', type: 'string' },
                { name: 'ScheduleName', type: 'string' },
                { name: 'Basis', type: 'string' },
                { name: 'FrequencyType', type: 'string' },
                { name: 'FrequencyValue', type: 'string' },
                { name: 'Reminders' },
                {
                    name: 'RemindersDisplay',
                    type: 'string',
                    convert: function (value, record) {
                        var result = [];
                        var i;
                        var reminders = record.get('Reminders');
                        if (reminders.length > 0) {
                            for (i = 0; i < reminders.length; i++) {
                                var periodType = reminders[i].PeriodType == 'Hourly' ? 'Hour' : 'Day';
                                var periodValue = reminders[i].PeriodValue;

                                if (periodValue > 1) {
                                    periodType += 's';
                                }

                                var postfixes = ['', 'st', 'nd', 'rd'];
                                var index = i + 1;
                                var indexStr = index + (index < 4 ? postfixes[index] : 'th');

                                result[i] = Ext.String.format('{0} {1} {2} later', indexStr, periodValue, periodType);
                            }
                            return result.join('&nbsp;&nbsp;&nbsp;');
                        }
                        else {
                            return '-';
                        }
                    }
                },
                { name: 'CreationDate', type: 'string' }
            ]
    });
</script>

<script type="text/javascript">
    window.feature.modal.stores.productGroups = Ext.define('snapshot-Outpost-ProductGroupsStore', {
        
        extend: 'Ext.data.Store',
        fields: ['Id', 'Name'],
        proxy: {
            type: 'ajax',
            url: '@Url.RouteUrl(StockAdministrationAreaRegistration.DEFAULT_ROUTE, new { controller = "Product", action = "GetProductGroups" })',
            reader: {
                type: 'json',
                root: 'productGroups'
            }
        }
    });

</script>

<script type="text/javascript">
    window.feature.modal.stores.schedules = Ext.define('snapshot-SchedulesStore', {
        extend: 'Ext.data.Store',
        model: window.feature.modal.models.Schedule,
        proxy: {
            type: 'ajax',
            url: '@Url.RouteUrl(Web.Bootstrap.Routes.DefaultRouteRegistrar.DEFAULT_ROUTE, new { controller = "ProductLevelRequest", action = "GetSchedules" })',
            reader: {
                type: 'json'
            }
        },
        remoteSort: true
    });

</script>

<script type="text/javascript">

    window.feature.createProductLevelRequest = Ext.define('snapshot-Outpost-AssignProductsModalWindow', {
        extend: 'Ext.window.Window',
        modal: true,
        height: 600,
        width: 1200,
        bodyPadding: 0,
        bodyStyle: 'background-color:#fff',
        layout: 'fit',

        initComponent: function () {
            var me = this;

            me.buttons = [
                {
                    text: 'Cancel', handler: function () {
                        me.close();
                        me.destroy();
                    }
                }, {
                    text: 'Save', handler: function () {
                    }
                }
            ];

            me.productGroupStore = new window.feature.modal.stores.productGroups();
            me.schedules = new window.feature.modal.stores.schedules();

            me.items = [
                {
                    xtype: 'panel',
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'panel',
                            height: 50,
                            layout: 'column',
                            items: [
                                {
                                    xtype: 'combobox',
                                    fieldLabel: 'Campaign',
                                    emptyText: 'Campaign List'
                                }, {
                                    xtype: 'combobox',
                                    fieldLabel: 'Product Group',
                                    store: me.productGroupStore,
                                    emptyText: 'Product Group List',
                                    queryMode: 'local',
                                    valueField: 'Id',
                                    displayField: 'Name'
                                }
                            ]
                        }, {
                            xtype: 'gridpanel',
                            autoscroll: true,
                            columns: [
                                {
                                    header: 'Product Item',
                                    dataIndex: 'ProductItem',
                                    flex: 1
                                }, {
                                    header: 'SMS Code',
                                    dataIndex: 'SmsCode',
                                    flex: 1
                                }, {
                                    header: 'Selected',
                                    dataIndex: 'Selected'
                                }
                            ],
                            flex: 1
                        }, {
                            xtype: 'panel',
                            height: 30,
                            html: _t('Please select a schedule')
                        }, {
                            xtype: 'gridpanel',
                            store: me.schedules,
                            autoscroll: true,
                            columns: [
                                {
                                    header: 'Schedule',
                                    dataIndex: 'ScheduleName',
                                    flex: 1
                                }, {
                                    header: 'Basis',
                                    dataIndex: 'Basis'
                                }, {
                                    header: 'Frequency',
                                    dataIndex: 'Fequency'
                                }, {
                                    header: 'Reminders',
                                    flex: 1,
                                    dataIndex: 'RemindersDisplay'
                                }, {
                                    header: 'Selected',
                                    dataIndex: 'Selected'
                                }
                            ],
                            flex: 1
                        }
                    ]

                }

            ];

            me.callParent(arguments);
            me.productGroupStore.load();
            me.schedules.load();

        }

    });
</script>