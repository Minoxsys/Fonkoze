@model Web.Areas.OutpostManagement.Models.District.DistrictOverviewModel
@using Microsoft.Web.Mvc
@{
    ViewBag.Title = "Overview";
}
@section page_title{
Districts: Overview
}
@section breadcrumbs{
    @Url.HomeLink("Dashboard") > Districts
}
@section master_content{
    @if (Model.Error != null)
    {
        <div class="error">
            @Model.Error
        </div>
    }
    <div class="page_header_buttons">
        @(Html.ActionLink<Web.Areas.OutpostManagement.Controllers.DistrictController>(it => it.Create(), "Create district", Web.Areas.OutpostManagement.OutpostManagementAreaRegistration.DEFAULT_ROUTE))
    </div>
    <br />
    <table class="searchable">
        <thead>
            <tr>
                <th>
                    <label>
                        Country:</label>
                         <select name="@(Html.NameFor(m=>m.Countries))">
                   @{
                       foreach(var item in Model.Countries){
                            <option value="@item.Value" @(item.Selected? @"selected='selected'" : @"") >@item.Text</option>
                       }
                   }
                   </select>
                   </th>
                <th>
                    <label>
                        Region:</label>
                    @Html.DropDownList("Regions", Model.Regions, new { onChange = "onRegionChanged()" })
                </th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

       
    @{
        Html.RenderPartial("OverviewTable", Model.Districts);
    }
}
@section scripts{
    <script type="text/javascript">
        $(function () {
            $(".delete-user-form").submit(function () {
                return confirm('Are you sure that you want to delete this district?')
            });

            $("select[name='@Html.NameFor(m=>m.Countries)']").change(onCountryChanged);
        });

        function onRegionChanged() {

            var reg = document.getElementById("Regions");
            
            var selectedRegionId = reg.options[reg.selectedIndex].value;
           
            console.log(reg.selectedIndex);
            console.log(selectedRegionId);

            var drop = $("#district-overview")
            drop.html('')

            var urlOverview = '@Url.Action("OverviewTable")?regionId=' + selectedRegionId;
            $.get(urlOverview, function (data) {
                debugger;
                console.log(data);
                $('#district-overview').html(data);
            });

        }
        function onCountryChanged() {
            var e = $(this)[0];
            var selectedCountryId = e.options[e.selectedIndex].value;

            $.getJSON('@Url.Action("GetRegionsForCountry", "District")?countryId=' + selectedCountryId, function (data) {
                var drop = $("#Regions")
                drop.html('')

                var drop = $("#district-overview")
                drop.html('')

                var ddlRegions = document.getElementById("Regions");
                var opt = document.createElement("option");
                opt.text = 'Please select a region';
                opt.value = '0';
                ddlRegions.options.add(opt);

                $.each(data, function () {
                    var opt = document.createElement("option");
                    opt.text = this['Text'];
                    opt.value = this['Value'];
                    ddlRegions.options.add(opt);
                });

            });


        }                  
    </script>
}
