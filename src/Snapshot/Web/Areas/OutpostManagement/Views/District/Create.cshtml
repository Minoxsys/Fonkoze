@model Web.Areas.OutpostManagement.Models.District.DistrictOutputModel
@using Microsoft.Web.Mvc
@section page_title{
District : Create
}
@section breadcrumbs{
    @Url.HomeLink("Outpost Administration") / @(Html.ActionLink<DistrictController>(act => act.Overview(null, null), "Districts Overview", OutpostManagementAreaRegistration.DEFAULT_ROUTE))
> Create District
}
@section master_content{
    @{Html.BeginForm<DistrictController>(r => r.Create(null,null));}
    <fieldset class="fieldsCollection ">
        @{
            Html.RenderPartial("Input", Model);     
        }
    </fieldset>
    @Html.SubmitButton("submit-form", "Save") <span>or </span><a href="@(Html.BuildUrlFromExpression<DistrictController>(it => it.Overview(null,null)))" id="cancel">
        Cancel</a>
    @{Html.EndForm();}
}
@section scripts{
    <script type="text/javascript">

         var selectedRegionId = $("select[name='@Html.NameFor(m => m.Region.Id)']").val();
         var selectedCountryId = $("select[name='@Html.NameFor(m => m.Region.CountryId)']").val();

        document.getElementById('cancel').href = '@Url.Action("Overview")?countryId=' + selectedCountryId + '&regionId=' + selectedRegionId;

        $("select[name='@Html.NameFor(m => m.Region.CountryId)']").change(function () {
            var e = $(this)[0];
            var selectedCountryId = e.options[e.selectedIndex].value;
            
            $.getJSON('@Url.Action("GetRegionsForCountry", "District")?countryId=' + selectedCountryId, function (data) {
                var drop = $("select[name='@Html.NameFor(m => m.Region.Id)']")
                drop.html('')
                var opt = document.createElement("option");
                opt.text = "- Select Region -";
                opt.value = '@Guid.Empty.ToString("n")';

                drop.append(opt);

                $.each(data, function () {
                    var opt = document.createElement("option");
                    opt.text = this['Text'];
                    opt.value = this['Value'];
                    drop.append(opt);
                });

            });

            var selectedRegionId = $("select[name='@Html.NameFor(m => m.Region.Id)']").val();
        
            document.getElementById('cancel').href = '@Url.Action("Overview")?countryId=' + selectedCountryId + '&regionId=' + selectedRegionId;

            $("select[name='@Html.NameFor(m => m.Region.CountryId)'] option[value='@Guid.Empty.ToString()']").remove();
        });

        $("select[name='@Html.NameFor(m => m.Region.Id)']").change(function () {
            $("select[name='@Html.NameFor(m => m.Region.Id)'] option[value='@Guid.Empty.ToString("n")']").remove();
        });  
        
        
        
      function onDistrictChanged() {

           var e = $(this)[0];
           var selectedDistrictId = e.options[e.selectedIndex].value;

           var drop = $("#outpost-overview")

           var urlOverview = '@Url.Action("OverviewOutpost")?districtId=' + selectedDistrictId;
           $.get(urlOverview, function (data) {

               drop.html('')

               $('#outpost-overview').html(data);
           });
           var selectedRegionId = $("select[name='@Html.NameFor(m => m.Region.Id)']").val();
         var selectedCountryId = $("select[name='@Html.NameFor(m => m.Region.CountryId)']").val();

        document.getElementById('cancel').href = '@Url.Action("Overview")?countryId=' + selectedCountryId + '&regionId=' + selectedRegionId;

       }    
    </script>
}
