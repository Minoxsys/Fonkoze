@model Web.Areas.OutpostManagement.Models.Region.RegionOverviewModel
@using Microsoft.Web.Mvc
@{
    ViewBag.Title = "Overview";
}
@section page_title{
Regions: Overview
}
@section breadcrumbs{
    @Url.HomeLink("Outpost Administration") > Regions
}
@section master_content{
    @if(Model.Error!=null){
        <div class="error">
            @Model.Error
        </div>
    }
    <div class="page_header_buttons">
        @(Html.ActionLink<Web.Areas.OutpostManagement.Controllers.RegionController>(it => it.Create(), "Create region", Web.Areas.OutpostManagement.OutpostManagementAreaRegistration.DEFAULT_ROUTE))
    </div><br />

    <table class="searchable">
        <thead>
            <tr>
                <th>
                    <label>
                        Country:</label>
                  
                   <select name="@(Html.NameFor(m=>m.Countries))">
                   @{
                       foreach(var item in Model.Countries){
                            <option value="@item.Value" @(item.Selected? @"selected='selected'" : @"") >@item.Text</option>
                       }
                   }
                   </select>
                   
                </th>
           </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

     @{
        Html.RenderPartial("OverviewTable", Model.Regions);
    }
}

@section master_actions{
    @{
        Html.RenderPartial("~/Views/Shared/_OutpostManagementActions.cshtml");
    }

}

@section scripts{
    <script type="text/javascript">
        $(function () {
            $(".delete-user-form").submit(function () {
                return confirm('Are you sure that you want to delete this region?')
            });

            $("select[name='@Html.NameFor(m=>m.Countries)']").change(onCountryChanged);
        });


        function onCountryChanged() {

            var e = $(this)[0];
            var selectedCountryId = e.options[e.selectedIndex].value;

            var drop = $("#region-overview")
            
            var urlOverview = '@Url.Action("OverviewTable")?countryId=' + selectedCountryId;
            $.get(urlOverview, function (data) {

                drop.html('')

                $('#region-overview').html(data);
            });

      }           
    </script>
}
